---
import SeeMoreButton from "../components/SeeMoreButton.astro";
const { title, techs, showAllLabel } = Astro.props;

const topSkills = [
  {
    name: "Java",
    icon: "https://cdn.jsdelivr.net/gh/devicons/devicon/icons/java/java-original.svg",
    iconAlt: "Java logo",
  },
  {
    name: "Spring",
    icon: "https://cdn.jsdelivr.net/gh/devicons/devicon/icons/spring/spring-original.svg",
    iconAlt: "Spring logo",
  },
  {
    name: "AWS",
    icon: "https://cdn.jsdelivr.net/gh/devicons/devicon/icons/amazonwebservices/amazonwebservices-original-wordmark.svg",
    iconAlt: "AWS logo",
  },
  {
    name: "Kafka",
    icon: "https://cdn.jsdelivr.net/gh/devicons/devicon/icons/apachekafka/apachekafka-original.svg",
    iconAlt: "Apache Kafka logo",
  },
  {
    name: "Python",
    icon: "https://cdn.jsdelivr.net/gh/devicons/devicon/icons/python/python-original.svg",
    iconAlt: "Python logo",
  },
  {
    name: "Node.js",
    icon: "https://cdn.jsdelivr.net/gh/devicons/devicon/icons/nodejs/nodejs-original.svg",
    iconAlt: "Node.js logo",
  },
];

const topSkillNames = new Set(topSkills.map((skill) => skill.name));
const remainingSkills = techs.filter((tech: string) => !topSkillNames.has(tech));
const toggleId = `skills-toggle-${Math.random().toString(36).slice(2, 9)}`;
const listId = `skills-list-${Math.random().toString(36).slice(2, 9)}`;
---
<div id="skills" class="mb-5">
  <div class="text-3xl w-full font-bold text-center">{title}</div>
</div>

<div class="mb-4 grid grid-cols-3 gap-2 md:max-w-lg md:mx-auto">
  {topSkills.map((skill) => (
    <div class="rounded-lg border border-base-300/40 py-2 px-2 text-center bg-transparent shadow-none flex flex-col items-center">
      <div class="h-9 w-9 p-1.5 flex items-center justify-center" aria-hidden="true">
        <img
          src={skill.icon}
          alt={skill.iconAlt}
          width="26"
          height="26"
          loading="lazy"
          decoding="async"
          class="h-full w-full object-contain"
        />
      </div>
      <div class="text-xs font-medium mt-1">{skill.name}</div>
    </div>
  ))}
</div>

{remainingSkills.length > 0 && (
  <div class="mx-2 md:mx-6 mb-6 flex flex-col items-center">
    <SeeMoreButton id={toggleId} label={showAllLabel} ariaExpanded="false" ariaControls={listId} />
    <ul id={listId} class="hidden list-disc md:columns-5 columns-2 mx-6 mt-3 self-stretch">
      {remainingSkills.map((name: string) => (
        <li>{name}</li>
      ))}
    </ul>
  </div>
)}

<script define:vars={{ toggleId, listId }}>
  const toggleBtn = document.getElementById(toggleId);
  const list = document.getElementById(listId);

  toggleBtn?.addEventListener(
    "click",
    () => {
      if (!list || !toggleBtn) return;
      list.classList.remove("hidden");
      toggleBtn.setAttribute("aria-expanded", "true");
      toggleBtn.classList.add("hidden");
    },
    { once: true }
  );
</script>
