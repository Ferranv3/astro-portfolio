---
import { Image } from "astro:assets";
import RssIcon from "./icons/RssIcon";
import LinkedinIcon from "./icons/LinkedinIcon";
import GithubIcon from "./icons/GithubIcon";

const {
  labels,
  homeHref = "/",
  contactEmail = "ferranhpv3@gmail.com",
} = Astro.props;

const sectionHref = (hash: string) => `${homeHref}${hash}`;
---

<aside class="drawer-side bg-base-200" aria-labelledby="sidebar-title">
  <label for="my-drawer" class="drawer-overlay bg-base-200" aria-hidden="true"></label>
  <nav
    id="sidebar-navigation"
    class="menu flex h-screen w-full max-w-[85vw] flex-col items-center justify-between gap-6 overflow-y-auto bg-base-200 px-4 py-6 text-base-content sm:max-w-sm lg:max-w-xs"
    aria-label="Primary"
    aria-hidden="true"
  >
    <div class="w-full">
      <a href={homeHref} class="flex justify-center" id="sidebar-title">
        <div class="avatar block h-36 w-36 transition ease-in-out hover:scale-[102%]">
          <div>
            <Image
              class="mask mask-circle"
              format="webp"
              width={300}
              height={300}
              src="/profile.webp"
              alt="Profile image"
              loading="lazy"
              decoding="async"
            />
          </div>
        </div>
      </a>
    </div>
    <ul class="menu menu-compact w-full gap-2">
      <li>
        <a class="menu-link block w-full rounded-lg px-4 py-2 font-medium hover:bg-base-300 focus:bg-base-300 focus:outline-none focus-visible:ring focus-visible:ring-primary/60" id="home" href={homeHref}>
          {labels.home}
        </a>
      </li>
      <li>
        <a class="menu-link block w-full rounded-lg px-4 py-2 font-medium hover:bg-base-300 focus:bg-base-300 focus:outline-none focus-visible:ring focus-visible:ring-primary/60" id="projects" href={sectionHref("#projects")}>
          {labels.projects}
        </a>
      </li>
      <li>
        <a class="menu-link block w-full rounded-lg px-4 py-2 font-medium hover:bg-base-300 focus:bg-base-300 focus:outline-none focus-visible:ring focus-visible:ring-primary/60" id="experience" href={sectionHref("#experience")}>
          {labels.experience}
        </a>
      </li>
      <li>
        <a class="menu-link block w-full rounded-lg px-4 py-2 font-medium hover:bg-base-300 focus:bg-base-300 focus:outline-none focus-visible:ring focus-visible:ring-primary/60" id="education" href={sectionHref("#education")}>
          {labels.education}
        </a>
      </li>
      <li>
        <a class="menu-link block w-full rounded-lg px-4 py-2 font-medium hover:bg-base-300 focus:bg-base-300 focus:outline-none focus-visible:ring focus-visible:ring-primary/60" id="languages" href={sectionHref("#languages")}>
          {labels.languages}
        </a>
      </li>
      <li>
        <a class="menu-link block w-full rounded-lg px-4 py-2 font-medium hover:bg-base-300 focus:bg-base-300 focus:outline-none focus-visible:ring focus-visible:ring-primary/60" id="certifications" href={sectionHref("#certifications")}>
          {labels.certifications}
        </a>
      </li>
      <li>
        <a class="menu-link block w-full rounded-lg px-4 py-2 font-medium hover:bg-base-300 focus:bg-base-300 focus:outline-none focus-visible:ring focus-visible:ring-primary/60" id="skills" href={sectionHref("#skills")}>
          {labels.skills}
        </a>
      </li>
      <li>
        <a class="menu-link block w-full rounded-lg px-4 py-2 font-medium hover:bg-base-300 focus:bg-base-300 focus:outline-none focus-visible:ring focus-visible:ring-primary/60" href={`mailto:${contactEmail}`}>
          {labels.contact}
        </a>
      </li>
    </ul>
    <div class="flex items-center gap-6">
      <a
        href="https://github.com/Ferranv3"
        target="_blank"
        class="transition hover:scale-105"
        aria-label="Github"
        title="Github"
      >
        <GithubIcon />
      </a>
      <a
        href="https://www.linkedin.com/in/ferran-hernandez-v3/"
        target="_blank"
        class="transition hover:scale-105"
        aria-label="Linkedin"
        title="Linkedin"
      >
        <LinkedinIcon />
      </a>
      <a
        href="/rss.xml"
        target="_blank"
        class="transition hover:scale-105"
        aria-label="RSS Feed"
        title="RSS Feed"
      >
        <RssIcon />
      </a>
    </div>
  </nav>
</aside>

<script>
  (() => {
    const drawer = document.getElementById('my-drawer');
    const nav = document.getElementById('sidebar-navigation');
    const toggleButtons = document.querySelectorAll('[data-drawer-toggle]');

    if (!(drawer instanceof HTMLInputElement) || !nav) {
      return;
    }

    const getLinks = () => nav.querySelectorAll('a.menu-link');

    const isDesktop = () =>
      typeof window !== 'undefined' && window.matchMedia('(min-width: 1024px)').matches;

    const syncAria = () => {
      const expanded = drawer.checked;
      const expandedValue = expanded ? 'true' : 'false';
      const hidden = expanded || isDesktop() ? 'false' : 'true';
      nav.setAttribute('aria-hidden', hidden);
      toggleButtons.forEach((button) => {
        if (button instanceof HTMLElement) {
          button.setAttribute('aria-expanded', expandedValue);
        }
      });
    };

    const closeDrawer = () => {
      if (drawer.checked) {
        drawer.checked = false;
        syncAria();
      }
    };

    const toggleDrawer = () => {
      drawer.checked = !drawer.checked;
      syncAria();
    };

    toggleButtons.forEach((button) => {
      button.addEventListener('click', () => {
        toggleDrawer();
      });
    });

    getLinks().forEach((link) => {
      link.addEventListener('click', () => {
        closeDrawer();
      });
    });

    document.addEventListener('keydown', (event) => {
      if (event.key === 'Escape') {
        closeDrawer();
      }
    });

    drawer.addEventListener('change', syncAria);

    const desktopQuery =
      typeof window !== 'undefined' ? window.matchMedia('(min-width: 1024px)') : undefined;
    desktopQuery?.addEventListener('change', syncAria);

    syncAria();
  })();
</script>
