---
import { defaultLanguage, supportedLanguages } from "../i18n/translations";

// Normaliza formatos: array vs mapa
const fallback = typeof defaultLanguage === "string" ? defaultLanguage : "en";
const supportedList = Array.isArray(supportedLanguages)
  ? supportedLanguages
  : Object.keys(supportedLanguages || {});

// BASE_URL se resuelve en build; si no hay base, usa "/"
const base = import.meta.env.BASE_URL || "/";
const supportedJson = JSON.stringify(supportedList);
---

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Redirecting…</title>

    <!-- Fallback si JS está deshabilitado -->
    <noscript>
      <meta http-equiv="refresh" content={`0;url=${base.replace(/\/$/, "")}/${fallback}/`} />
    </noscript>

    <!-- Config accesible para el script externo (no es inline JS) -->
    <meta
      id="i18n-config"
      data-supported={supportedJson}
      data-fallback={fallback}
      data-base={base}
    />

    <!-- Script EXTERNO (no choca con CSP) -->
    <script src="/redirect.js" defer></script>
  </head>
  <body style="display:flex;align-items:center;justify-content:center;height:100vh;margin:0;background:#fff;">
    <main
      role="status"
      aria-live="polite"
      aria-busy="true"
      style="display:flex;flex-direction:column;align-items:center;gap:1rem;text-align:center;font-family:system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;color:#1f2933;"
    >
      <div
        style="width:32px;height:32px;border:3px solid #cbd5e1;border-top-color:#1f2933;border-radius:50%;animation:spin 0.8s linear infinite;"
        aria-hidden="true"
      ></div>
      <p id="redirect-visible" style="margin:0;font-size:1rem;">
        Checking your preferred language…
      </p>
      <p id="redirect-status" class="sr-only">Checking your preferred language…</p>
    </main>
    <style>
      @keyframes spin { to { transform: rotate(360deg); } }
      .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
      }
    </style>
  </body>

</html>

